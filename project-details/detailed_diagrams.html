<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detailed System Diagrams & Sequences</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 40px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        h2 {
            color: #34495e;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        
        .diagram-container {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .sequence-diagram {
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 800px;
        }
        
        .sequence-actors {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .actor {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 120px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(116, 185, 255, 0.3);
        }
        
        .sequence-step {
            display: flex;
            align-items: center;
            margin: 10px 0;
            position: relative;
        }
        
        .step-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .step-description {
            background: #e8f4f8;
            padding: 12px 20px;
            border-radius: 8px;
            flex: 1;
            border-left: 4px solid #667eea;
        }
        
        .step-arrow {
            margin: 0 15px;
            font-size: 1.5em;
            color: #667eea;
        }
        
        .component-diagram {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .component-box {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(162, 155, 254, 0.3);
            transition: transform 0.3s ease;
        }
        
        .component-box:hover {
            transform: translateY(-5px);
        }
        
        .component-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .component-details {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .component-details li {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .component-details li:last-child {
            border-bottom: none;
        }
        
        .data-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        
        .flow-node {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(253, 121, 168, 0.3);
            position: relative;
            min-width: 150px;
        }
        
        .flow-arrow {
            font-size: 2em;
            color: #667eea;
            margin: 0 10px;
        }
        
        .database-schema {
            background: #e8f5e8;
            border: 2px solid #27ae60;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .schema-table {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .table-name {
            font-weight: bold;
            color: #27ae60;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .field-list {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .field-header {
            font-weight: bold;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
        }
        
        .field-item {
            padding: 5px 8px;
            background: #f8f9fa;
            border-radius: 4px;
            margin: 2px 0;
        }
        
        .api-flow {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .code-snippet {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .highlight-box {
            background: linear-gradient(45deg, #ffeaa7, #fdcb6e);
            padding: 20px;
            border-radius: 10px;
            color: #2d3436;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(255, 234, 167, 0.3);
        }
        
        @media (max-width: 768px) {
            .sequence-actors {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .data-flow {
                flex-direction: column;
            }
            
            .flow-arrow {
                transform: rotate(90deg);
            }
            
            .field-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Detailed System Diagrams & Sequences</h1>
        
        <h2>üìä Component Architecture Diagram</h2>
        <div class="diagram-container">
            <div class="component-diagram">
                <div class="component-box">
                    <div class="component-title">üåê Frontend Layer</div>
                    <ul class="component-details">
                        <li>Next.js 14 Dashboard</li>
                        <li>React Components</li>
                        <li>Tailwind CSS Styling</li>
                        <li>Recharts Visualization</li>
                        <li>WebSocket Client</li>
                        <li>Authentication Context</li>
                        <li>State Management (Zustand)</li>
                    </ul>
                </div>
                
                <div class="component-box">
                    <div class="component-title">üì± SDK Layer</div>
                    <ul class="component-details">
                        <li>JavaScript Web SDK</li>
                        <li>Android Native SDK</li>
                        <li>Event Batching</li>
                        <li>Offline Storage</li>
                        <li>Automatic Retry</li>
                        <li>Session Management</li>
                        <li>User Identification</li>
                    </ul>
                </div>
                
                <div class="component-box">
                    <div class="component-title">üöÄ API Gateway</div>
                    <ul class="component-details">
                        <li>Express.js Server</li>
                        <li>JWT Authentication</li>
                        <li>Rate Limiting</li>
                        <li>Request Validation</li>
                        <li>CORS Handling</li>
                        <li>Error Management</li>
                        <li>API Versioning</li>
                    </ul>
                </div>
                
                <div class="component-box">
                    <div class="component-title">üß† AI Service</div>
                    <ul class="component-details">
                        <li>AWS Bedrock Integration</li>
                        <li>Claude 3.5 Sonnet</li>
                        <li>Text-to-SQL Engine</li>
                        <li>Query Validation</li>
                        <li>Schema Context</li>
                        <li>Insight Generation</li>
                        <li>Response Caching</li>
                    </ul>
                </div>
                
                <div class="component-box">
                    <div class="component-title">üíæ Data Layer</div>
                    <ul class="component-details">
                        <li>PostgreSQL (Users/Config)</li>
                        <li>ClickHouse (Events)</li>
                        <li>Redis (Cache/Sessions)</li>
                        <li>Connection Pooling</li>
                        <li>Query Optimization</li>
                        <li>Backup Strategy</li>
                        <li>Data Partitioning</li>
                    </ul>
                </div>
                
                <div class="component-box">
                    <div class="component-title">üì° Real-time Engine</div>
                    <ul class="component-details">
                        <li>Socket.io Server</li>
                        <li>Event Broadcasting</li>
                        <li>Room Management</li>
                        <li>Connection Pooling</li>
                        <li>Heartbeat Monitoring</li>
                        <li>Failover Handling</li>
                        <li>Load Balancing</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <h2>üîÑ Event Tracking Sequence Diagram</h2>
        <div class="diagram-container">
            <div class="sequence-diagram">
                <div class="sequence-actors">
                    <div class="actor">Web App</div>
                    <div class="actor">SDK</div>
                    <div class="actor">API Gateway</div>
                    <div class="actor">Database</div>
                    <div class="actor">Real-time Engine</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">1</div>
                    <div class="step-description">User performs action (click, page view, etc.)</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">2</div>
                    <div class="step-description">SDK captures event with metadata (timestamp, user_id, properties)</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">3</div>
                    <div class="step-description">SDK batches events and sends to API Gateway</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">4</div>
                    <div class="step-description">API Gateway validates request and authenticates user</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">5</div>
                    <div class="step-description">Events are written to ClickHouse database</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">6</div>
                    <div class="step-description">Real-time engine broadcasts event to connected dashboards</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">7</div>
                    <div class="step-description">Dashboard receives real-time update and refreshes UI</div>
                </div>
            </div>
        </div>
        
        <h2>ü§ñ AI Query Processing Sequence</h2>
        <div class="diagram-container">
            <div class="sequence-diagram">
                <div class="sequence-actors">
                    <div class="actor">Dashboard</div>
                    <div class="actor">AI Service</div>
                    <div class="actor">AWS Bedrock</div>
                    <div class="actor">Query Engine</div>
                    <div class="actor">Database</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">1</div>
                    <div class="step-description">User enters natural language query: "Show me top 10 events this week"</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">2</div>
                    <div class="step-description">AI Service validates input and builds context with schema information</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">3</div>
                    <div class="step-description">Send enriched prompt to AWS Bedrock Claude model</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">4</div>
                    <div class="step-description">Bedrock returns generated SQL query with explanation</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">5</div>
                    <div class="step-description">AI Service validates SQL syntax and security constraints</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">6</div>
                    <div class="step-description">Execute validated query against ClickHouse database</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">7</div>
                    <div class="step-description">Process results and generate insights using AI</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">8</div>
                    <div class="step-description">Return formatted data with visualization suggestions</div>
                </div>
            </div>
        </div>
        
        <h2>üóÑÔ∏è Database Schema Relationships</h2>
        <div class="database-schema">
            <div class="schema-table">
                <div class="table-name">üë• Users Table (PostgreSQL)</div>
                <div class="field-list">
                    <div class="field-header">Field</div>
                    <div class="field-header">Type</div>
                    <div class="field-header">Description</div>
                    
                    <div class="field-item">id</div>
                    <div class="field-item">UUID</div>
                    <div class="field-item">Primary Key</div>
                    
                    <div class="field-item">email</div>
                    <div class="field-item">VARCHAR(255)</div>
                    <div class="field-item">User email (unique)</div>
                    
                    <div class="field-item">properties</div>
                    <div class="field-item">JSONB</div>
                    <div class="field-item">Custom user attributes</div>
                    
                    <div class="field-item">first_seen</div>
                    <div class="field-item">TIMESTAMP</div>
                    <div class="field-item">First user activity</div>
                    
                    <div class="field-item">last_seen</div>
                    <div class="field-item">TIMESTAMP</div>
                    <div class="field-item">Last user activity</div>
                </div>
            </div>
            
            <div class="schema-table">
                <div class="table-name">üìä Events Table (ClickHouse)</div>
                <div class="field-list">
                    <div class="field-header">Field</div>
                    <div class="field-header">Type</div>
                    <div class="field-header">Description</div>
                    
                    <div class="field-item">id</div>
                    <div class="field-item">UUID</div>
                    <div class="field-item">Event identifier</div>
                    
                    <div class="field-item">user_id</div>
                    <div class="field-item">String</div>
                    <div class="field-item">Foreign key to users</div>
                    
                    <div class="field-item">event_name</div>
                    <div class="field-item">String</div>
                    <div class="field-item">Event type identifier</div>
                    
                    <div class="field-item">properties</div>
                    <div class="field-item">Map(String, String)</div>
                    <div class="field-item">Event metadata</div>
                    
                    <div class="field-item">timestamp</div>
                    <div class="field-item">DateTime</div>
                    <div class="field-item">Event occurrence time</div>
                    
                    <div class="field-item">platform</div>
                    <div class="field-item">Enum</div>
                    <div class="field-item">web, android, ios</div>
                </div>
            </div>
            
            <div class="schema-table">
                <div class="table-name">üîó Sessions Table (PostgreSQL)</div>
                <div class="field-list">
                    <div class="field-header">Field</div>
                    <div class="field-header">Type</div>
                    <div class="field-header">Description</div>
                    
                    <div class="field-item">id</div>
                    <div class="field-item">UUID</div>
                    <div class="field-item">Session identifier</div>
                    
                    <div class="field-item">user_id</div>
                    <div class="field-item">UUID</div>
                    <div class="field-item">Reference to users</div>
                    
                    <div class="field-item">session_start</div>
                    <div class="field-item">TIMESTAMP</div>
                    <div class="field-item">Session begin time</div>
                    
                    <div class="field-item">duration_seconds</div>
                    <div class="field-item">INTEGER</div>
                    <div class="field-item">Session length</div>
                    
                    <div class="field-item">events_count</div>
                    <div class="field-item">INTEGER</div>
                    <div class="field-item">Events in session</div>
                </div>
            </div>
        </div>
        
        <h2>üåä Data Flow Architecture</h2>
        <div class="diagram-container">
            <div class="data-flow">
                <div class="flow-node">Client Events</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-node">SDK Batching</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-node">API Ingestion</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-node">Data Validation</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-node">Database Storage</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-node">Real-time Broadcast</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-node">Dashboard Update</div>
            </div>
        </div>
        
        <h2>üîó API Integration Flow</h2>
        <div class="api-flow">
            <h3>Event Ingestion API</h3>
            <div class="code-snippet">
POST /api/v1/events
Content-Type: application/json
Authorization: Bearer &lt;jwt-token&gt;

{
  "events": [
    {
      "user_id": "user_123",
      "event_name": "page_view",
      "properties": {
        "page": "/dashboard",
        "referrer": "google.com",
        "utm_source": "paid_search"
      },
      "timestamp": "2025-06-12T10:30:00Z"
    }
  ]
}
            </div>
            
            <h3>AI Query API</h3>
            <div class="code-snippet">
POST /api/v1/ai/query
Content-Type: application/json
Authorization: Bearer &lt;jwt-token&gt;

{
  "question": "What are the top 5 pages by traffic this month?",
  "context": {
    "date_range": "30d",
    "filters": {
      "platform": "web"
    }
  }
}

Response:
{
  "sql": "SELECT properties['page'] as page, COUNT(*) as views FROM events WHERE event_name = 'page_view' AND platform = 'web' AND timestamp >= now() - INTERVAL 30 DAY GROUP BY page ORDER BY views DESC LIMIT 5",
  "data": [...],
  "insights": ["Homepage traffic increased 25% this month"],
  "visualization": "bar_chart"
}
            </div>
        </div>
        
        <h2>‚ö° Real-time Event Broadcasting</h2>
        <div class="diagram-container">
            <div class="sequence-diagram">
                <div class="sequence-actors">
                    <div class="actor">Event Source</div>
                    <div class="actor">API Server</div>
                    <div class="actor">WebSocket Server</div>
                    <div class="actor">Dashboard Client</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">1</div>
                    <div class="step-description">New event arrives at API endpoint</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">2</div>
                    <div class="step-description">Event is validated and stored in database</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">3</div>
                    <div class="step-description">API server publishes event to WebSocket server</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">4</div>
                    <div class="step-description">WebSocket server broadcasts to subscribed clients</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">5</div>
                    <div class="step-description">Dashboard receives event and updates UI in real-time</div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">6</div>
                    <div class="step-description">Metrics are recalculated and charts are updated</div>
                </div>
            </div>
        </div>
        
        <h2>üîí Security Architecture</h2>
        <div class="component-diagram">
            <div class="component-box">
                <div class="component-title">üõ°Ô∏è Authentication</div>
                <ul class="component-details">
                    <li>JWT Access Tokens (15 min)</li>
                    <li>Refresh Tokens (7 days)</li>
                    <li>Token Rotation</li>
                    <li>Secure Cookie Storage</li>
                    <li>Multi-factor Authentication</li>
                    <li>Session Management</li>
                </ul>
            </div>
            
            <div class="component-box">
                <div class="component-title">üö® Rate Limiting</div>
                <ul class="component-details">
                    <li>1000 events/minute per user</li>
                    <li>100 API calls/minute per user</li>
                    <li>10 AI queries/minute per user</li>
                    <li>Redis-based counters</li>
                    <li>Progressive backoff</li>
                    <li>IP-based limiting</li>
                </ul>
            </div>
            
            <div class="component-box">
                <div class="component-title">üîê Data Protection</div>
                <ul class="component-details">
                    <li>AES-256 encryption at rest</li>
                    <li>TLS 1.3 in transit</li>
                    <li>PII data masking</li>
                    <li>Secure key management</li>
                    <li>Regular security audits</li>
                    <li>GDPR compliance</li>
                </ul>
            </div>
        </div>
        
        <h2>üìà Scalability Strategy</h2>
        <div class="diagram-container">
            <div class="data-flow">
                <div class="flow-node">Load Balancer<br>(ALB)</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-node">API Servers<br>(Auto Scaling)</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-node">Database Cluster<br>(Read Replicas)</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-node">Redis Cluster<br>(Sharding)</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-node">CDN<br>(Global Cache)</div>
            </div>
        </div>
        
        <div class="highlight-box">
            üéØ This architecture can handle 1M+ events per hour with sub-100ms response times and 99.9% uptime!
            <br><br>
            ‚ú® Key Features: Real-time updates, AI-powered insights, horizontal scalability, and enterprise-grade security.
        </div>
    </div>
</body>
</html>